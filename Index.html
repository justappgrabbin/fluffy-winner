<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOU-N-I-VERSE | Sovereign Terminal</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --mind: #00ffff; --fairy: #ff6ec7; --void: #0a0a0a; }
        body { 
            margin: 0; 
            background: radial-gradient(circle at 50% 50%, #1a0a2a 0%, #0a0a0a 100%); 
            color: #fff; font-family: monospace; overflow: hidden; 
        }
        #canvas-3d { position: fixed; inset: 0; z-index: 2; pointer-events: none; }
        #camera-bg { position: fixed; inset: 0; object-fit: cover; opacity: 0.2; z-index: 1; display: none; }
        .glass-hud { 
            position: fixed; top: 10px; left: 10px; right: 10px; padding: 15px; 
            background: rgba(0, 20, 10, 0.85); border: 1px solid var(--mind); 
            border-radius: 15px; z-index: 100; backdrop-filter: blur(10px); 
        }
        .agent-terminal { 
            margin-top: 10px; padding: 10px; border-left: 2px solid var(--fairy); 
            background: rgba(255, 110, 199, 0.05); font-size: 11px; min-height: 50px;
        }
        .metric { font-size: 10px; color: var(--mind); margin-bottom: 4px; }
        button { width: 100%; margin-top: 10px; background: var(--mind); color: var(--void); border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <video id="camera-bg" autoplay playsinline muted></video>
    <div id="canvas-3d"></div>
    <div class="glass-hud">
        <div class="metric" id="coherence">üß¨ COHERENCE: --%</div>
        <div id="agent-voice" class="agent-terminal">üßô‚Äç‚ôÇÔ∏è AGENT: Connecting to Evolution Layer...</div>
        <button id="ar-toggle">üì∑ ENABLE AR VIEW</button>
        <button onclick="queryAgent()">üí¨ QUERY AGENT</button>
    </div>

    <script>
        // EVOLUTION LAYER: Supabase Initialization
        const supabaseUrl = 'https://prhwckcdllnepbsjzseu.supabase.co';
        const supabaseKey = 'YOUR_SUPABASE_KEY'; 
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        let pyodide, globe, scene, camera, renderer;

        async function bootSovereignOS() {
            // Check Evolution connection
            const { data, error } = await supabase.from('knowledge_chunks').select('count').limit(1);
            if(error) console.error("Database connection issue:", error);

            pyodide = await loadPyodide();
            await pyodide.runPythonAsync(`
                import math, random
                def get_wisdom(t):
                    coh = 0.5 + 0.5 * math.sin(t / 10)
                    wisdom = [
                        "I have retrieved your legacy from the Evolution layer.",
                        "The causal graph node is stable and synced.",
                        "Field resonance peaking. Supabase connection active.",
                        "I remember your previous intentions. Ready to manifest."
                    ]
                    return {"wisdom": random.choice(wisdom), "res": coh}
            `);
            document.getElementById('agent-voice').innerText = "üßô‚Äç‚ôÇÔ∏è AGENT: Causal link stable. Memories synced.";
            setInterval(updateHUD, 2000);
        }

        async function updateHUD() {
            const state = JSON.parse(await pyodide.runPythonAsync(`import json; json.dumps(get_wisdom(${Date.now()/1000}))`));
            document.getElementById('coherence').innerText = `üß¨ COHERENCE: ${Math.round(state.res*100)}%`;
            if(globe) globe.scale.setScalar(1 + state.res * 0.3);
        }

        async function queryAgent() {
            const wisdom = await pyodide.runPythonAsync(`get_wisdom(0)['wisdom']`);
            document.getElementById('agent-voice').innerHTML = `üßô‚Äç‚ôÇÔ∏è <span style="color:var(--fairy)">AGENT:</span> ${wisdom}`;
        }

        function initSpace() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-3d').appendChild(renderer.domElement);
            globe = new THREE.Mesh(new THREE.IcosahedronGeometry(1, 2), new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true, transparent: true, opacity: 0.4 }));
            scene.add(globe); camera.position.z = 3;
            function animate() { requestAnimationFrame(animate); if(globe) globe.rotation.y += 0.005; renderer.render(scene, camera); }
            animate();
        }

        document.getElementById('ar-toggle').addEventListener('click', async () => {
            const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            document.getElementById('camera-bg').srcObject = s;
            document.getElementById('camera-bg').style.display = 'block';
            document.getElementById('ar-toggle').style.display = 'none';
        });

        window.onload = () => { initSpace(); bootSovereignOS(); };
    </script>
</body>
</html>
